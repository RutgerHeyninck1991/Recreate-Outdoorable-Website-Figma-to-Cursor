import React, {  useState,  useCallback,  useRef,  useEffect,  useMemo,  memo,} from "react";import { Link, useParams } from "react-router-dom";import { Button } from "./ui/button";import { Label } from "./ui/label";import { Input } from "./ui/input";import { Slider } from "./ui/slider";import { Switch } from "./ui/switch";import {  Card,  CardContent,  CardHeader,  CardTitle,} from "./ui/card";import { Badge } from "./ui/badge";import {  Tabs,  TabsContent,  TabsList,  TabsTrigger,} from "./ui/tabs";import { RadioGroup, RadioGroupItem } from "./ui/radio-group";import {  ArrowLeft,  ArrowRight,  RotateCcw,  ZoomIn,  RotateCw,  Save,  ShoppingCart,  Heart,  Share2,  Eye,  Sparkles,  Zap,  CheckCircle,  Home,  ChevronRight,  X,  Loader2,  Smartphone,  RotateCw as RotateIcon,  RefreshCw,  Package,  Sofa,  Circle,  Square,  Layers,  Upload,  HelpCircle,  Info,  Palette,  Filter,  Search,} from "lucide-react";import { ImageWithFallback } from "./figma/ImageWithFallback";import { motion, AnimatePresence } from "motion/react";import {  useFabrics,  useFabricCategories,  fabricApi,  type Fabric,} from "../utils/fabricApi";import FabricStep from "./FabricStep";import outdoorableLogo from "../assets/23cc91becaaf56a7cc57ff9c082be886de142ac2.png";import GLBCushionViewer from "./GLBCushionViewer";// 3D Preview Component (simplified version)const CushionPreview = memo(  React.forwardRef(    (      {        cushionType,        shape,        width,        height,        depth,        selectedFabric,        filling,        piping,        pipingColor,        bandAfwerking,        ritsPositie,      },      ref,    ) => {      const [rotation, setRotation] = useState({        x: 15,        y: -8,      });      const [isDragging, setIsDragging] = useState(false);      const [zoom, setZoom] = useState(1);      const cushionWidth = Math.min(width * 2, 320);      const cushionHeight = Math.min(height * 1.5, 180);      const cushionDepth = Math.min(depth * 1.5, 35);      // Mouse handlers for rotation      const handlePointerDown = useCallback((e) => {        setIsDragging(true);        const startX =          e.clientX ||          (e.touches && e.touches[0]?.clientX) ||          0;        const startY =          e.clientY ||          (e.touches && e.touches[0]?.clientY) ||          0;        const handlePointerMove = (e) => {          const clientX =            e.clientX ||            (e.touches && e.touches[0]?.clientX) ||            0;          const clientY =            e.clientY ||            (e.touches && e.touches[0]?.clientY) ||            0;          const deltaX = clientX - startX;          const deltaY = clientY - startY;          setRotation((prev) => ({            x: Math.max(              -90,              Math.min(90, prev.x - deltaY * 0.5),            ),            y: prev.y + deltaX * 0.5,          }));        };        const handlePointerUp = () => {          setIsDragging(false);          document.removeEventListener(            "mousemove",            handlePointerMove,          );          document.removeEventListener(            "mouseup",            handlePointerUp,          );          document.removeEventListener(            "touchmove",            handlePointerMove,          );          document.removeEventListener(            "touchend",            handlePointerUp,          );        };        document.addEventListener(          "mousemove",          handlePointerMove,        );        document.addEventListener("mouseup", handlePointerUp);        document.addEventListener(          "touchmove",          handlePointerMove,          { passive: false },        );        document.addEventListener("touchend", handlePointerUp);        e.preventDefault();      }, []);      const cushionStyle = useMemo(        () => ({          width: `${cushionWidth}px`,          height: `${cushionHeight}px`,          backgroundColor: selectedFabric?.color || "#E8DCC6",          backgroundImage: selectedFabric?.textureUrl            ? `url(${selectedFabric.textureUrl})`            : selectedFabric?.texturePattern || "none",          backgroundSize: selectedFabric?.textureUrl            ? "cover"            : "auto",          backgroundPosition: "center",          backgroundRepeat: selectedFabric?.textureUrl            ? "no-repeat"            : "repeat",          borderRadius: shape === "rond" ? "50%" : "16px",          border: piping ? `4px solid ${pipingColor}` : "none",          transformStyle: "preserve-3d",          cursor: isDragging ? "grabbing" : "grab",          transform: `rotateX(${rotation.x}deg) rotateY(${rotation.y}deg) scale(${zoom})`,          transition: isDragging            ? "none"            : "transform 0.4s cubic-bezier(0.4, 0, 0.2, 1)",          boxShadow: `0 ${20 + zoom * 5}px ${40 + zoom * 10}px rgba(0,0,0,0.15)`,        }),        [          cushionWidth,          cushionHeight,          selectedFabric,          piping,          pipingColor,          shape,          rotation,          isDragging,          zoom,        ],      );      // Check if we should use GLB viewer for zitkussen-strak with recht shape      const useGLBViewer =        cushionType === "zitkussen-strak" && shape === "recht";      if (useGLBViewer) {        return (          <GLBCushionViewer            modelUrl="https://iydxusrdnduybpnhozvi.supabase.co/storage/v1/object/public/3D%20MODEL/GLB%20TEST%20ZITKUSSEN%20STRAK.glb"            selectedFabric={selectedFabric}            width={width}            height={height}            depth={depth}          />        );      }      return (        <div          className="w-full h-full flex items-center justify-center bg-gradient-to-br from-stone-100 via-stone-50 to-stone-200 relative overflow-hidden touch-none select-none"          style={{ perspective: "1200px" }}        >          <div className="relative">            <div              className="relative flex items-center justify-center text-stone-600 font-medium"              style={cushionStyle}              onMouseDown={handlePointerDown}              onTouchStart={handlePointerDown}            >              <div className="relative z-10 text-center pointer-events-none">                <div className="text-lg mb-1">                  {width} × {height} × {depth} cm                </div>                <div className="text-sm opacity-80">                  {cushionType?.charAt(0).toUpperCase() +                    cushionType?.slice(1)}{" "}                  - {shape}                </div>              </div>            </div>          </div>        </div>      );    },  ),);CushionPreview.displayName = "CushionPreview";// Step Componentsconst StepIndicator = ({ currentStep, totalSteps }) => (  <div className="flex items-center justify-center space-x-2 mb-8">    {Array.from({ length: totalSteps }, (_, i) => (      <div key={i} className="flex items-center">        <div          className={`w-8 h-8 rounded-full flex items-center justify-center text-sm font-medium transition-all duration-300 ${            i + 1 === currentStep              ? "bg-stone-800 text-white"              : i + 1 < currentStep                ? "bg-green-500 text-white"                : "bg-stone-200 text-stone-600"          }`}        >          {i + 1 < currentStep ? (            <CheckCircle className="w-4 h-4" />          ) : (            i + 1          )}        </div>        {i < totalSteps - 1 && (          <div            className={`w-8 h-1 mx-2 rounded-full transition-all duration-300 ${              i + 1 < currentStep                ? "bg-green-500"                : "bg-stone-200"            }`}          />        )}      </div>    ))}  </div>);// Step 1: Choose Cushion Typeconst CushionTypeStep = ({  selectedType,  onSelect,  preSelected = false,}) => {  const cushionTypes = [    {      id: "zitkussen-strak",      name: "Zitkussen Strak",      description: "Strak zitkussen met vaste vorm",      icon: Sofa,      popular: true,      image:        "https://images.unsplash.com/photo-1586023492125-27b2c045efd7?w=300&h=200&fit=crop&q=80",    },    {      id: "zitkussen-plof",      name: "Zitkussen Plof",      description: "Zachter zitkussen met plof-vulling",      icon: Package,      popular: true,      image:        "https://images.unsplash.com/photo-1560472354-b33ff0c44a43?w=300&h=200&fit=crop&q=80",    },    {      id: "rugkussen-strak",      name: "Rugkussen Strak",      description: "Recht rugkussen met stevig foam",      icon: Layers,      popular: false,      image:        "https://images.unsplash.com/photo-1555041469-a586c61ea9bc?w=300&h=200&fit=crop&q=80",    },    {      id: "rugkussen-plof",      name: "Rugkussen Plof",      description: "Plof-rugkussen met losse vlokken",      icon: Package,      popular: false,      image:        "https://images.unsplash.com/photo-1506439773649-6e0eb8cfb237?w=300&h=200&fit=crop&q=80",    },    {      id: "rugkussen-schuin",      name: "Rugkussen Schuin",      description: "Rugkussen dat schuin naar achter helt",      icon: Layers,      popular: false,      image:        "https://images.unsplash.com/photo-1544735716-392fe2489ffa?w=300&h=200&fit=crop&q=80",    },    {      id: "hockerkussen",      name: "Hockerkussen / Poef",      description: "Kussen om op te zitten (footstool/poef)",      icon: Circle,      popular: false,      image:        "https://images.unsplash.com/photo-1600607687920-4e2a09cf159d?w=300&h=200&fit=crop&q=80",    },    {      id: "sierkussen",      name: "Sierkussen",      description: "Decoratief kussen",      icon: Square,      popular: false,      image:        "https://images.unsplash.com/photo-1578662996442-48f60103fc96?w=300&h=200&fit=crop&q=80",    },    {      id: "alleen-stof",      name: "Alleen Stof",      description: "Alleen losse stof zonder vulling",      icon: Layers,      popular: false,      image:        "https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?w=300&h=200&fit=crop&q=80",    },    {      id: "opberghoes",      name: "Opberghoes",      description: "Hoes om kussens in te bewaren",      icon: Package,      popular: false,      image:        "https://images.unsplash.com/photo-1613490493576-7fde63acd811?w=300&h=200&fit=crop&q=80",    },  ];  if (preSelected) {    const selectedTypeObj = cushionTypes.find(      (type) => type.id === selectedType,    );    return (      <div className="space-y-6">        <div className="text-center">          <h2 className="text-3xl font-medium text-stone-800 mb-4">            Type kussen geselecteerd          </h2>          <p className="text-lg text-stone-600 max-w-2xl mx-auto">            U heeft gekozen voor{" "}            <strong>{selectedTypeObj?.name}</strong>. U kunt dit            wijzigen of doorgaan naar de vorm selectie.          </p>        </div>        <div className="flex justify-center">          <div className="max-w-sm">            <motion.div              className="group rounded-2xl border-2 border-green-500 bg-green-50 shadow-lg overflow-hidden"              initial={{ scale: 0.9, opacity: 0 }}              animate={{ scale: 1, opacity: 1 }}              transition={{ duration: 0.5 }}            >              <div className="relative">                <img                  src={selectedTypeObj?.image}                  alt={selectedTypeObj?.name}                  className="w-full h-32 object-cover"                />                <Badge className="absolute top-2 left-2 bg-green-500 text-white">                  Geselecteerd                </Badge>                <div className="absolute bottom-2 right-2 w-10 h-10 bg-white/80 backdrop-blur-sm rounded-full flex items-center justify-center">                  {selectedTypeObj?.icon && (                    <selectedTypeObj.icon className="w-5 h-5 text-stone-700" />                  )}                </div>              </div>              <div className="p-4">                <h3 className="text-lg font-medium text-stone-800 mb-2">                  {selectedTypeObj?.name}                </h3>                <p className="text-sm text-stone-600">                  {selectedTypeObj?.description}                </p>                <div className="mt-3 flex items-center text-green-600">                  <CheckCircle className="w-4 h-4 mr-2" />                  <span className="text-sm font-medium">                    Gekozen via homepage                  </span>                </div>              </div>            </motion.div>          </div>        </div>        <div className="text-center">          <Button            variant="outline"            onClick={() => onSelect("")}            className="border-stone-300 text-stone-700 hover:bg-stone-50"          >            Ander type kiezen          </Button>        </div>      </div>    );  }  return (    <div className="space-y-6">      <div className="text-center">        <h2 className="text-3xl font-medium text-stone-800 mb-4">          Kies het type kussen        </h2>        <p className="text-lg text-stone-600 max-w-2xl mx-auto">          Begin met het selecteren van het type kussen dat u          nodig heeft. Elke type heeft zijn eigen specificaties          en vorm opties.        </p>      </div>      <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">        {cushionTypes.map((type) => (          <motion.div            key={type.id}            className={`group cursor-pointer rounded-2xl border-2 transition-all duration-300 overflow-hidden ${              selectedType === type.id                ? "border-stone-800 bg-stone-50 shadow-lg"                : "border-stone-200 hover:border-stone-400 hover:shadow-md"            }`}            whileHover={{ scale: 1.02 }}            whileTap={{ scale: 0.98 }}            onClick={() => onSelect(type.id)}          >            <div className="relative">              <img                src={type.image}                alt={type.name}                className="w-full h-32 object-cover"              />              {type.popular && (                <Badge className="absolute top-2 left-2 bg-amber-500 text-white">                  Populair                </Badge>              )}              <div className="absolute bottom-2 right-2 w-10 h-10 bg-white/80 backdrop-blur-sm rounded-full flex items-center justify-center">                <type.icon className="w-5 h-5 text-stone-700" />              </div>            </div>            <div className="p-4">              <h3 className="text-lg font-medium text-stone-800 mb-2">                {type.name}              </h3>              <p className="text-sm text-stone-600">                {type.description}              </p>              {selectedType === type.id && (                <div className="mt-3 flex items-center text-green-600">                  <CheckCircle className="w-4 h-4 mr-2" />                  <span className="text-sm font-medium">                    Geselecteerd                  </span>                </div>              )}            </div>          </motion.div>        ))}      </div>      <div className="mt-8 p-4 bg-blue-50 rounded-xl border border-blue-200">        <div className="flex items-start space-x-3">          <Info className="w-5 h-5 text-blue-600 mt-0.5" />          <div>            <h4 className="font-medium text-blue-800 mb-1">              Belangrijk om te weten            </h4>            <p className="text-sm text-blue-700">              De opties "alleen hoes" of "alleen vulling" worden              beschikbaar nadat u een vorm heeft geselecteerd.              Voor alle types kunt u later kiezen uit              verschillende afwerkingen en materialen.            </p>          </div>        </div>      </div>    </div>  );};// Step 2: Choose Shapeconst ShapeStep = ({  cushionType,  selectedShape,  onSelect,}) => {  const getShapesForType = (type) => {    const shapes = {      "zitkussen-strak": [        {          id: "recht",          name: "Rechthoek",          description: "Standaard rechthoekige vorm",          icon: "▬",        },        {          id: "schuine-zijde-1",          name: "1 Schuine zijde",          description: "Één zijde schuin",          icon: "⬅",        },        {          id: "schuine-zijde-2",          name: "2 Schuine zijden",          description: "Twee zijden schuin",          icon: "⬌",        },        {          id: "ongelijk-kort",          name: "Ongelijk (rits korte zijde)",          description: "Asymmetrisch met rits kort",          icon: "⬒",        },        {          id: "ongelijk-lang",          name: "Ongelijk (rits lange zijde)",          description: "Asymmetrisch met rits lang",          icon: "⬓",        },        {          id: "trapezium-kort",          name: "Trapezium (rits kort)",          description: "Trapeziumvorm met rits kort",          icon: "⬔",        },        {          id: "trapezium-lang",          name: "Trapezium (rits lang)",          description: "Trapeziumvorm met rits lang",          icon: "⬕",        },        {          id: "rond",          name: "Rond/Ovaal",          description: "Ronde of ovale vorm",          icon: "●",        },        {          id: "halfrond",          name: "Halfrond",          description: "Halfronde vorm",          icon: "◐",        },      ],      "zitkussen-plof": [        {          id: "recht",          name: "Rechthoek",          description: "Standaard rechthoekige vorm",          icon: "▬",        },        {          id: "ongelijk-kort",          name: "Ongelijk (rits korte zijde)",          description: "Asymmetrisch met rits kort",          icon: "⬒",        },        {          id: "ongelijk-lang",          name: "Ongelijk (rits lange zijde)",          description: "Asymmetrisch met rits lang",          icon: "⬓",        },        {          id: "trapezium-kort",          name: "Trapezium (rits kort)",          description: "Trapeziumvorm met rits kort",          icon: "⬔",        },        {          id: "trapezium-lang",          name: "Trapezium (rits lang)",          description: "Trapeziumvorm met rits lang",          icon: "⬕",        },      ],      "rugkussen-strak": [        {          id: "recht",          name: "Rechthoek",          description: "Standaard rechthoekige vorm",          icon: "▬",        },        {          id: "ongelijk-kort",          name: "Ongelijk (rits korte zijde)",          description: "Asymmetrisch met rits kort",          icon: "⬒",        },        {          id: "ongelijk-lang",          name: "Ongelijk (rits lange zijde)",          description: "Asymmetrisch met rits lang",          icon: "⬓",        },        {          id: "trapezium",          name: "Trapezium",          description: "Trapeziumvorm",          icon: "⬔",        },      ],      "rugkussen-plof": [        {          id: "recht",          name: "Rechthoek",          description: "Standaard rechthoekige vorm",          icon: "▬",        },        {          id: "ongelijk-kort",          name: "Ongelijk (rits korte zijde)",          description: "Asymmetrisch met rits kort",          icon: "⬒",        },        {          id: "trapezium",          name: "Trapezium",          description: "Trapeziumvorm",          icon: "⬔",        },      ],      "rugkussen-schuin": [        {          id: "recht",          name: "Recht",          description: "Rechthoekige basis vorm",          icon: "▬",        },        {          id: "ongelijk-links",          name: "Ongelijk links",          description: "Schuin naar links",          icon: "◤",        },        {          id: "ongelijk-rechts",          name: "Ongelijk rechts",          description: "Schuin naar rechts",          icon: "◥",        },      ],      hockerkussen: [        {          id: "recht",          name: "Rechthoek",          description: "Rechthoekige vorm",          icon: "▬",        },        {          id: "rond",          name: "Rond/Ovaal",          description: "Ronde of ovale vorm",          icon: "●",        },      ],      sierkussen: [        {          id: "recht",          name: "Rechthoek/Vierkant",          description: "Standaard vorm voor sierkussens",          icon: "▬",        },      ],      "alleen-stof": [],      opberghoes: [],    };    return shapes[type] || [];  };  const availableShapes = getShapesForType(cushionType);  if (    cushionType === "alleen-stof" ||    cushionType === "opberghoes"  ) {    return (      <div className="text-center space-y-6">        <h2 className="text-3xl font-medium text-stone-800">          Vormkeuze niet nodig        </h2>        <p className="text-lg text-stone-600">          Voor{" "}          {cushionType === "alleen-stof"            ? "alleen stof"            : "opberghoezen"}{" "}          gaan we direct door naar de volgende stap.        </p>        <div className="inline-flex items-center px-6 py-3 bg-green-50 text-green-700 rounded-full border border-green-200">          <CheckCircle className="w-5 h-5 mr-2" />          <span>Ga door naar kleur en afmetingen</span>        </div>      </div>    );  }  return (    <div className="space-y-6">      <div className="text-center">        <h2 className="text-3xl font-medium text-stone-800 mb-4">          Kies de vorm        </h2>        <p className="text-lg text-stone-600 max-w-2xl mx-auto">          Selecteer de vorm die het beste past bij uw{" "}          {cushionType.replace("-", " ")}. Elke vorm heeft zijn          eigen specifieke toepassingen.        </p>      </div>      <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-4">        {availableShapes.map((shape) => (          <motion.div            key={shape.id}            className={`group cursor-pointer p-6 rounded-xl border-2 text-center transition-all duration-300 ${              selectedShape === shape.id                ? "border-stone-800 bg-stone-50 shadow-lg"                : "border-stone-200 hover:border-stone-400 hover:shadow-md"            }`}            whileHover={{ scale: 1.02 }}            whileTap={{ scale: 0.98 }}            onClick={() => onSelect(shape.id)}          >            <div className="text-4xl mb-3 text-stone-700">              {shape.icon}            </div>            <h3 className="text-lg font-medium text-stone-800 mb-2">              {shape.name}            </h3>            <p className="text-sm text-stone-600 mb-3">              {shape.description}            </p>            {selectedShape === shape.id && (              <div className="flex items-center justify-center text-green-600">                <CheckCircle className="w-4 h-4 mr-2" />                <span className="text-sm font-medium">                  Geselecteerd                </span>              </div>            )}          </motion.div>        ))}      </div>      <div className="mt-8 p-4 bg-yellow-50 rounded-xl border border-yellow-200">        <div className="flex items-start space-x-3">          <Info className="w-5 h-5 text-yellow-600 mt-0.5" />          <div>            <h4 className="font-medium text-yellow-800 mb-1">              Vorm toelichting            </h4>            <p className="text-sm text-yellow-700">              Een kussen met een schuine zijde kan zowel links              als rechts worden geplaatst. Bij modellen met              ritsposities kunt u later kiezen tussen korte of              lange zijde. Voor afwijkende vormen die niet in de              lijst staan, kunt u contact opnemen of een schets              uploaden.            </p>          </div>        </div>      </div>      <div className="text-center">        <Button          variant="outline"          className="border-stone-300 text-stone-700 hover:bg-stone-50"        >          <Upload className="w-4 h-4 mr-2" />          Afwijkende vorm uploaden        </Button>      </div>    </div>  );};// Step 3: Dimensionsconst DimensionsStep = ({  width,  height,  depth,  onWidthChange,  onHeightChange,  onDepthChange,  cushionType,}) => {  const getDimensionTips = (type) => {    if (type?.includes("plof")) {      return "Voor plofkussens adviseren we 2-5 cm extra breedte zodat het kussen niet te klein oogt.";    }    return "Voor lounge zithoogte adviseren we 42-45 cm. Meet uw meubel op voor de exacte afmetingen.";  };  return (    <div className="space-y-8">      <div className="text-center">        <h2 className="text-3xl font-medium text-stone-800 mb-4">          Afmetingen invoeren        </h2>        <p className="text-lg text-stone-600 max-w-2xl mx-auto">          Voer de gewenste afmetingen in centimeters in. U kunt          de waardes aanpassen met de schuifregelaars of direct          invoeren.        </p>      </div>      <div className="grid md:grid-cols-3 gap-8">        <div className="space-y-4">          <Label className="text-lg font-medium text-stone-800">            Lengte (cm)          </Label>          <div className="space-y-3">            <Input              type="number"              value={width}              onChange={(e) =>                onWidthChange(parseInt(e.target.value) || 0)              }              className="text-lg text-center"              min="10"              max="300"            />            <Slider              value={[width]}              onValueChange={(value) => onWidthChange(value[0])}              max={300}              min={10}              step={1}              className="w-full"            />            <div className="text-sm text-stone-500 text-center">              10 - 300 cm            </div>          </div>        </div>        <div className="space-y-4">          <Label className="text-lg font-medium text-stone-800">            Breedte (cm)          </Label>          <div className="space-y-3">            <Input              type="number"              value={height}              onChange={(e) =>                onHeightChange(parseInt(e.target.value) || 0)              }              className="text-lg text-center"              min="10"              max="200"            />            <Slider              value={[height]}              onValueChange={(value) =>                onHeightChange(value[0])              }              max={200}              min={10}              step={1}              className="w-full"            />            <div className="text-sm text-stone-500 text-center">              10 - 200 cm            </div>          </div>        </div>        <div className="space-y-4">          <Label className="text-lg font-medium text-stone-800">            Dikte (cm)          </Label>          <div className="space-y-3">            <Input              type="number"              value={depth}              onChange={(e) =>                onDepthChange(parseInt(e.target.value) || 0)              }              className="text-lg text-center"              min="2"              max="50"            />            <Slider              value={[depth]}              onValueChange={(value) => onDepthChange(value[0])}              max={50}              min={2}              step={1}              className="w-full"            />            <div className="text-sm text-stone-500 text-center">              2 - 50 cm            </div>          </div>        </div>      </div>      <div className="bg-blue-50 p-6 rounded-xl border border-blue-200">        <div className="flex items-start space-x-3">          <Info className="w-5 h-5 text-blue-600 mt-0.5" />          <div>            <h4 className="font-medium text-blue-800 mb-2">              Afmeting tips            </h4>            <p className="text-sm text-blue-700 mb-2">              {getDimensionTips(cushionType)}            </p>            <ul className="text-sm text-blue-700 space-y-1">              <li>                • Meet altijd uw meubel op voor de juiste maten              </li>              <li>                • Houd rekening met eventuele armleuningen              </li>              <li>                • Bij twijfel kunt u contact opnemen voor advies              </li>            </ul>          </div>        </div>      </div>      <div className="text-center">        <div className="inline-flex items-center px-6 py-3 bg-stone-100 rounded-full">          <span className="text-lg font-medium text-stone-800">            Afmetingen: {width} × {height} × {depth} cm          </span>        </div>      </div>    </div>  );};// Step 4: Fillingconst FillingStep = ({  selectedFilling,  onSelect,  cushionType,}) => {  const getFillingOptions = (type) => {    if (type?.includes("plof")) {      return [        {          id: "vlokken-compartiment",          name: "Vlokken met Compartimenten",          description:            "Losse vlokken in aparte compartimenten voor optimale verdeling",          firmness: 3,          durability: 4,          comfort: 5,          price: 25,          recommended: true,        },        {          id: "vlokken-los",          name: "Losse Vlokken",          description:            "Losse polyester vlokken voor zachte plof ervaring",          firmness: 2,          durability: 3,          comfort: 4,          price: 20,          recommended: false,        },      ];    } else {      return [        {          id: "polyether-sg35",          name: "Polyether SG35",          description:            "Standaard schuim voor dagelijks gebruik",          firmness: 3,          durability: 3,          comfort: 3,          price: 15,          recommended: false,        },        {          id: "koudschuim-sg40",          name: "Koudschuim SG40",          description:            "Premium koudschuim voor optimaal comfort en duurzaamheid",          firmness: 4,          durability: 5,          comfort: 4,          price: 25,          recommended: true,        },        {          id: "koudschuim-sg50",          name: "Koudschuim SG50",          description:            "Zeer stevig koudschuim voor maximale ondersteuning",          firmness: 5,          durability: 5,          comfort: 3,          price: 35,          recommended: false,        },        {          id: "memory-foam",          name: "Memory Foam",          description:            "Vorm behoudend schuim dat zich aanpast aan uw lichaam",          firmness: 3,          durability: 4,          comfort: 5,          price: 45,          recommended: false,        },      ];    }  };  const fillingOptions = getFillingOptions(cushionType);  const renderStars = (value, max = 5) => {    return Array.from({ length: max }, (_, i) => (      <div        key={i}        className={`w-3 h-3 rounded-full ${i < value ? "bg-green-500" : "bg-stone-200"}`}      />    ));  };  return (    <div className="space-y-6">      <div className="text-center">        <h2 className="text-3xl font-medium text-stone-800 mb-4">          Kies de vulling        </h2>        <p className="text-lg text-stone-600 max-w-2xl mx-auto">          Selecteer de vulling die past bij uw comfort wensen en          gebruik. Elke vulling heeft verschillende          eigenschappen voor stevigheid en duurzaamheid.        </p>      </div>      <div className="grid md:grid-cols-2 gap-6">        {fillingOptions.map((filling) => (          <motion.div            key={filling.id}            className={`group cursor-pointer p-6 rounded-xl border-2 transition-all duration-300 ${              selectedFilling === filling.id                ? "border-stone-800 bg-stone-50 shadow-lg"                : "border-stone-200 hover:border-stone-400 hover:shadow-md"            }`}            whileHover={{ scale: 1.01 }}            whileTap={{ scale: 0.99 }}            onClick={() => onSelect(filling.id)}          >            <div className="flex items-start justify-between mb-4">              <div>                <h3 className="text-lg font-medium text-stone-800 mb-2">                  {filling.name}                </h3>                {filling.recommended && (                  <Badge className="bg-green-500 text-white">                    Aanbevolen                  </Badge>                )}              </div>              <div className="text-lg font-medium text-stone-700">                +€{filling.price}              </div>            </div>            <p className="text-sm text-stone-600 mb-4">              {filling.description}            </p>            <div className="space-y-3">              <div className="flex items-center justify-between">                <span className="text-sm text-stone-600">                  Stevigheid                </span>                <div className="flex space-x-1">                  {renderStars(filling.firmness)}                </div>              </div>              <div className="flex items-center justify-between">                <span className="text-sm text-stone-600">                  Duurzaamheid                </span>                <div className="flex space-x-1">                  {renderStars(filling.durability)}                </div>              </div>              <div className="flex items-center justify-between">                <span className="text-sm text-stone-600">                  Comfort                </span>                <div className="flex space-x-1">                  {renderStars(filling.comfort)}                </div>              </div>            </div>            {selectedFilling === filling.id && (              <div className="mt-4 flex items-center text-green-600">                <CheckCircle className="w-4 h-4 mr-2" />                <span className="text-sm font-medium">                  Geselecteerd                </span>              </div>            )}          </motion.div>        ))}      </div>      <div className="bg-yellow-50 p-6 rounded-xl border border-yellow-200">        <div className="flex items-start space-x-3">          <Info className="w-5 h-5 text-yellow-600 mt-0.5" />          <div>            <h4 className="font-medium text-yellow-800 mb-2">              Vulling advies            </h4>            {cushionType?.includes("plof") ? (              <p className="text-sm text-yellow-700">                Voor plofkussens wordt vulling met                compartimenten aanbevolen voor betere verdeling                van de vlokken en langere levensduur.              </p>            ) : (              <p className="text-sm text-yellow-700">                Koudschuim SG40 biedt de beste balans tussen                comfort en duurzaamheid voor de meeste                toepassingen. Voor intensief gebruik adviseren                we SG50 voor extra stevigheid.              </p>            )}          </div>        </div>      </div>    </div>  );};// Main Configurator Componentexport default function CushionConfigurator() {  const { cushionType: urlCushionType } = useParams();  const [currentStep, setCurrentStep] = useState(    urlCushionType ? 2 : 1,  );  const [isLoading, setIsLoading] = useState(true);  // Configuration state  const [cushionType, setCushionType] = useState(    urlCushionType || "",  );  const [shape, setShape] = useState("");  const [width, setWidth] = useState(80);  const [height, setHeight] = useState(60);  const [depth, setDepth] = useState(12);  const [filling, setFilling] = useState("");  const [selectedFabric, setSelectedFabric] = useState(null);  const [piping, setPiping] = useState(false);  const [pipingColor, setPipingColor] = useState("#404040");  const [bandAfwerking, setBandAfwerking] = useState(false);  const [ritsPositie, setRitsPositie] = useState("korte-zijde");  const totalSteps = 7;  const cushionPreviewRef = useRef();  // Loading simulation  useEffect(() => {    const timer = setTimeout(() => {      setIsLoading(false);    }, 1000);    return () => clearTimeout(timer);  }, []);  const canProceedToNextStep = () => {    switch (currentStep) {      case 1:        return cushionType !== "";      case 2:        return (          shape !== "" ||          cushionType === "alleen-stof" ||          cushionType === "opberghoes"        );      case 3:        return width > 0 && height > 0 && depth > 0;      case 4:        return filling !== "";      case 5:        return true; // Afwerking is optional      case 6:        return selectedFabric !== null;      case 7:        return true;      default:        return false;    }  };  const handleNext = () => {    if (canProceedToNextStep()) {      setCurrentStep((prev) => Math.min(prev + 1, totalSteps));    }  };  const handlePrevious = () => {    setCurrentStep((prev) => Math.max(prev - 1, 1));  };  if (isLoading) {    return (      <div className="min-h-screen bg-gradient-to-br from-stone-50 via-white to-stone-100 flex items-center justify-center">        <div className="text-center space-y-6">          <Loader2 className="w-16 h-16 text-stone-600 mx-auto animate-spin" />          <h2 className="text-2xl text-stone-800 font-medium">            3D Configurator wordt geladen...          </h2>          <div className="w-64 h-2 bg-stone-200 rounded-full mx-auto overflow-hidden">            <div className="h-full bg-stone-600 rounded-full w-full animate-pulse" />          </div>        </div>      </div>    );  }  return (    <div className="min-h-screen bg-gradient-to-br from-stone-50 via-white to-stone-100">      {/* Navigation */}      <nav className="w-full px-6 lg:px-12 py-4 bg-white/95 backdrop-blur-md shadow-sm border-b border-stone-200/50 sticky top-0 z-50">        <div className="flex justify-between items-center">          <div className="flex items-center space-x-4">            <Link              to="/"              className="hover:opacity-80 transition-opacity"            >              <img                src={outdoorableLogo}                alt="Outdoorable"                className="h-14"              />            </Link>            <div className="hidden md:flex items-center space-x-2 text-sm text-stone-600">              <Link                to="/"                className="hover:text-stone-800 transition-colors flex items-center space-x-1"              >                <Home className="w-4 h-4" />                <span>Home</span>              </Link>              <ChevronRight className="w-4 h-4" />              <span className="text-stone-800 font-medium">                360° Configurator              </span>            </div>          </div>          <div className="flex items-center space-x-4">            <Link              to="/profile"              className="text-stone-700 hover:text-stone-900 transition-all duration-300"            >              Mijn Account            </Link>            <Button              variant="outline"              className="border-stone-300 text-stone-700 hover:bg-stone-50"            >              <Save className="w-4 h-4 mr-2" />              Opslaan            </Button>          </div>        </div>      </nav>      {/* Main Content */}      <div className="container mx-auto px-6 lg:px-12 py-8">        <div className="grid lg:grid-cols-2 gap-12">          {/* 3D Preview Panel - Shows first on mobile, right side on desktop */}          <div className="lg:sticky lg:top-24 h-fit order-first lg:order-last">            <Card className="aspect-square flex flex-col">              <CardHeader className="flex-none">                <CardTitle className="flex items-center justify-between">                  <span>3D Preview</span>                  <div className="flex space-x-2">                    <Button                      size="sm"                      variant="outline"                      onClick={() =>                        cushionPreviewRef.current?.resetRotation()                      }                      className="border-stone-300"                    >                      <RotateCcw className="w-4 h-4" />                    </Button>                    <Button                      size="sm"                      variant="outline"                      onClick={() =>                        cushionPreviewRef.current?.toggle360()                      }                      className="border-stone-300"                    >                      <RefreshCw className="w-4 h-4" />                    </Button>                  </div>                </CardTitle>              </CardHeader>              <CardContent className="p-0 flex-1 min-h-0">                <CushionPreview                  ref={cushionPreviewRef}                  cushionType={cushionType}                  shape={shape}                  width={width}                  height={height}                  depth={depth}                  selectedFabric={selectedFabric}                  filling={filling}                  piping={piping}                  pipingColor={pipingColor}                  bandAfwerking={bandAfwerking}                  ritsPositie={ritsPositie}                />              </CardContent>            </Card>            {/* Configuration Summary */}            <Card className="mt-6">              <CardHeader>                <CardTitle>Configuratie Overzicht</CardTitle>              </CardHeader>              <CardContent className="space-y-3">                <div className="flex justify-between">                  <span className="text-stone-600">Type:</span>                  <span className="font-medium">                    {cushionType                      ? cushionType.replace("-", " ")                      : "Niet geselecteerd"}                  </span>                </div>                <div className="flex justify-between">                  <span className="text-stone-600">Vorm:</span>                  <span className="font-medium">                    {shape || "Niet geselecteerd"}                  </span>                </div>                <div className="flex justify-between">                  <span className="text-stone-600">                    Afmetingen:                  </span>                  <span className="font-medium">                    {width} × {height} × {depth} cm                  </span>                </div>                <div className="flex justify-between">                  <span className="text-stone-600">                    Vulling:                  </span>                  <span className="font-medium">                    {filling || "Niet geselecteerd"}                  </span>                </div>                <div className="flex justify-between">                  <span className="text-stone-600">Stof:</span>                  <span className="font-medium">                    {selectedFabric?.name ||                      "Niet geselecteerd"}                  </span>                </div>                <div className="border-t border-stone-200 pt-3">                  <div className="flex justify-between text-lg font-medium">                    <span>Geschatte prijs:</span>                    <span>€ 89,00</span>                  </div>                  <p className="text-sm text-stone-500 mt-1">                    Exclusief verzendkosten                  </p>                </div>              </CardContent>            </Card>          </div>          {/* Configuration Panel - Shows second on mobile, left side on desktop */}          <div className="space-y-8 order-last lg:order-first">            <StepIndicator              currentStep={currentStep}              totalSteps={totalSteps}            />            <Card className="p-8">              <AnimatePresence mode="wait">                <motion.div                  key={currentStep}                  initial={{ opacity: 0, x: 20 }}                  animate={{ opacity: 1, x: 0 }}                  exit={{ opacity: 0, x: -20 }}                  transition={{ duration: 0.3 }}                >                  {currentStep === 1 && (                    <CushionTypeStep                      selectedType={cushionType}                      onSelect={setCushionType}                      preSelected={!!urlCushionType}                    />                  )}                  {currentStep === 2 && (                    <ShapeStep                      cushionType={cushionType}                      selectedShape={shape}                      onSelect={setShape}                    />                  )}                  {currentStep === 3 && (                    <DimensionsStep                      width={width}                      height={height}                      depth={depth}                      onWidthChange={setWidth}                      onHeightChange={setHeight}                      onDepthChange={setDepth}                      cushionType={cushionType}                    />                  )}                  {currentStep === 4 && (                    <FillingStep                      selectedFilling={filling}                      onSelect={setFilling}                      cushionType={cushionType}                    />                  )}                  {currentStep === 5 && (                    <div className="text-center space-y-6">                      <h2 className="text-3xl font-medium text-stone-800">                        Afwerking kiezen                      </h2>                      <p className="text-lg text-stone-600">                        Kies de gewenste afwerking voor uw                        kussen.                      </p>                      <div className="text-stone-500">                        Afwerking opties komen binnenkort                        beschikbaar...                      </div>                    </div>                  )}                  {currentStep === 6 && (                    <FabricStep                      selectedFabric={selectedFabric}                      onSelect={setSelectedFabric}                    />                  )}                  {currentStep === 7 && (                    <div className="text-center space-y-6">                      <h2 className="text-3xl font-medium text-stone-800">                        Extra opties                      </h2>                      <p className="text-lg text-stone-600">                        Voeg extra opties toe aan uw kussen.                      </p>                      <div className="text-stone-500">                        Extra opties komen binnenkort                        beschikbaar...                      </div>                    </div>                  )}                </motion.div>              </AnimatePresence>            </Card>            {/* Navigation Buttons */}            <div className="flex items-center justify-between">              <Button                variant="outline"                onClick={handlePrevious}                disabled={currentStep === 1}                className="border-stone-300 text-stone-700 hover:bg-stone-50"              >                <ArrowLeft className="w-4 h-4 mr-2" />                Vorige              </Button>              <div className="text-sm text-stone-600">                Stap {currentStep} van {totalSteps}              </div>              <Button                onClick={handleNext}                disabled={                  !canProceedToNextStep() ||                  currentStep === totalSteps                }                className="bg-stone-800 hover:bg-stone-900 text-white"              >                {currentStep === totalSteps                  ? "Voltooien"                  : "Volgende"}                {currentStep !== totalSteps && (                  <ArrowRight className="w-4 h-4 ml-2" />                )}              </Button>            </div>          </div>        </div>      </div>    </div>  );}
